import{writable as t,derived as e,get as s}from"svelte/store";const r=(t,e)=>{if(!Array.isArray(t))return null;for(const s of t)if("function"==typeof s)try{const t=s(e);if(null!=t)return t}catch(t){console.error("validator error",s,t)}return null};class o{constructor(t){this.validators=t}setValidators(t){Array.isArray(t)&&t.length&&(this.validators=t)}}class l extends o{constructor(s,o=[]){super(o),this.initial=s,this.value=t(this.initial),this.touched=t(!1),this.state=e([this.value,this.touched],([t,e])=>{const s=r(this.validators,t);return{$error:s,$valid:null==s,$touched:e,$dirty:this.initial!==t}})}setTouched(t){this.touched.set(t)}getControl(){return null}reset(t){this.touched.set(!1),null!=t&&(this.initial=t),this.value.set(this.initial)}}const i=/^([^.[]+)\.?(.*)$/;class n extends o{constructor(t,o=[]){super(o),this.controls=t,this.valueDerived=e(this.initControls(this.controls),t=>t),this.value={subscribe:this.valueDerived.subscribe,set:t=>this.setValue(t),update:t=>this.setValue(t(s(this.valueDerived)))},this.state=e(this.value,t=>{const e={};let o=!0,l=!1,i=!1;for(const t of Object.keys(this.controls)){const r=e[t]=s(this.controls[t].state);o=o&&r.$valid,l=l||r.$touched,i=i||r.$dirty}const n=r(this.validators,t),u=null==n&&o;return Object.assign({$error:n,$valid:u,$touched:l,$dirty:i},e)})}initControls(t){const s=Object.keys(t),r=s.map(t=>this.controls[t]).map(t=>t.value);return e(r,t=>t.reduce((t,e,r)=>(t[s[r]]=e,t),{}))}setValue(t){Object.keys(this.controls).forEach(e=>{this.controls[e].value.set(t[e])})}setTouched(t){Object.keys(this.controls).forEach(e=>{this.controls[e].setTouched(t)})}getControl(t){const[e,s,r]=t.match(i)||[],o=s&&this.controls[s]||null;return o?r?o.getControl(r):o:null}reset(t){Object.keys(this.controls).forEach(e=>{this.controls[e].reset(t[e])})}}const u=/^\[(\d+)\]\.?(.*)$/;class c extends o{constructor(o,l=[]){super(l),this._controls=o,this.controlStore=t(this._controls),this.valueDerived=e(this.controlStore,(t,s)=>e(t.map(t=>t.value),t=>t).subscribe(s)),this.value={subscribe:this.valueDerived.subscribe,set:t=>this.setValue(t),update:t=>this.setValue(t(s(this.valueDerived)))},this.state=e([this.value,this.controlStore],([t,e])=>{const o=[];let l=!0;for(let t=0,r=e.length;t<r;t++){const r=s(e[t].state);o[t]=r,l=l&&r.$valid,o.$touched=o.$touched||r.$touched,o.$dirty=o.$dirty||r.$dirty}return o.$error=r(this.validators,t),o.$valid=null==o.$error&&l,o})}setValue(t){s(this.controlStore).forEach((e,s)=>e.value.set(t[s]))}setTouched(t){s(this.controlStore).forEach(e=>e.setTouched(t))}get size(){return s(this.controlStore).length}get controls(){return s(this.controlStore)}pushControl(t){this.controlStore.update(e=>(e.push(t),e))}addControlAt(t,e){this.controlStore.update(s=>(s.splice(t,0,e),s))}removeControlAt(t){this.controlStore.update(e=>(e.splice(t,1),e))}slice(t,e){this.controlStore.update(s=>s.slice(t,e))}getControl(t){const[e,r,o]=t.match(u)||[],l=s(this.controlStore),i=null!=r&&l[+r]||null;return i?o?i.getControl(o):i:null}reset(t){s(this.controlStore).forEach((e,s)=>e.reset(t&&t[s]))}setValidators(t){Array.isArray(t)&&t.length&&(this.validators=t)}}const a=(t,e)=>{if(!(e instanceof l))throw new Error("must be used with a Control class");const s=t.classList,r=e.state.subscribe(t=>{t.$error?(s.add("invalid"),s.remove("valid")):(s.add("valid"),s.remove("invalid")),t.$dirty?(s.add("dirty"),s.remove("pristine")):(s.add("pristine"),s.remove("dirty")),t.$touched?s.add("touched"):s.remove("touched")}),o=["blur","focusout"],i=()=>o.forEach(e=>t.removeEventListener(e,n)),n=()=>{e.setTouched(!0),i()};return o.forEach(e=>t.addEventListener(e,n)),{destroy(){i(),r()}}},h=({onlyTouched:t=!1}={})=>(e,s)=>{if(!(s instanceof l))throw new Error("must be used with a Control class");return{destroy:s.state.subscribe(s=>{const r=s,o=!(t&&!r.$touched||!r.$error);e.hidden=!o,o&&(e.innerHTML=r.$error)})}},d=h(),v=(t,e=!0)=>s=>{let r=null!=s?`${s}`:"";return e&&(r=r.trim()),""!==r?null:t},$=/^([a-zA-Z0-9_\-\.]+)@([a-zA-Z0-9_\-\.]+)\.([a-zA-Z]{2,5})$/,y=t=>e=>null==e||$.test(e)?null:t,f=(t,e)=>s=>null!=s&&(null==e||`${s}`.length>=e)?null:t,b=(t,e)=>s=>null!=s&&(null==e||`${s}`.length<=e)?null:t,p=t=>e=>null==e||!isNaN(e)?null:t,m=/^[\d.]+$/,g=t=>e=>null==e||!isNaN(e)&&m.test(`${e}`)?null:t,S=/^[\d]+$/,C=t=>e=>null==e||!isNaN(e)&&S.test(`${e}`)?null:t,E=(t,e)=>s=>null==s||!isNaN(s)&&(null==e||s>=e)?null:t,A=(t,e)=>s=>null==s||!isNaN(s)&&(null==e||s<=e)?null:t,N=(t,e)=>s=>null==s||null==e||e.test(s)?null:t;export{l as Control,c as ControlArray,o as ControlBase,n as ControlGroup,a as controlClasses,d as controlError,h as controlErrorFactory,g as decimal,y as email,C as integer,A as max,b as maxLength,E as min,f as minLength,p as number,N as pattern,v as required};
//# sourceMappingURL=index.mjs.map
