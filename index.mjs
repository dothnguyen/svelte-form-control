import{writable as t,derived as e,get as s}from"svelte/store";const r=(t,e)=>{if(!Array.isArray(t))return null;for(const s of t)if("function"==typeof s)try{const t=s(e);if(null!=t)return t}catch(t){console.error("validator error",s,t)}return null};class l{constructor(t){this.validators=t}setValidators(t){Array.isArray(t)&&t.length&&(this.validators=t)}}class o extends l{constructor(s,l=[]){super(l),this.initial=s,this.value=t(this.initial),this.touched=t(!1),this.state=e([this.value,this.touched],([t,e])=>{const s=r(this.validators,t);return{$error:s,$valid:null==s,$touched:e,$dirty:this.initial!==t}})}setTouched(t){this.touched.set(t)}getControl(){return null}reset(t){this.touched.set(!1),null!=t&&(this.initial=t),this.value.set(this.initial)}}const i=/^([^.[]+)\.?(.*)$/;class n extends l{constructor(t,l=[]){super(l),this.controls=t,this.valueReadable=(t=>{const s=Object.keys(t),r=s.map(e=>t[e]).map(t=>t.value);return e(r,t=>t.reduce((t,e,r)=>(t[s[r]]=e,t),{}))})(this.controls),this.childStateReadable=(t=>{const s=Object.keys(t),r=s.map(e=>t[e]).map(t=>t.state);return e(r,t=>t.reduce((t,e,r)=>(t[s[r]]=e,t),{}))})(this.controls),this.value={subscribe:this.valueReadable.subscribe,set:t=>this.setValue(t),update:t=>this.setValue(t(s(this.valueReadable)))},this.state=e([this.valueReadable,this.childStateReadable],([t,e])=>{const s={};let l=!0,o=!1,i=!1;for(const t of Object.keys(this.controls)){const r=s[t]=e[t];l=l&&r.$valid,o=o||r.$touched,i=i||r.$dirty}const n=r(this.validators,t),a=null==n&&l;return Object.assign({$error:n,$valid:a,$touched:o,$dirty:i},s)})}setValue(t){Object.keys(this.controls).forEach(e=>{this.controls[e].value.set(t[e])})}setTouched(t){Object.keys(this.controls).forEach(e=>{this.controls[e].setTouched(t)})}getControl(t){const[e,s,r]=t.match(i)||[],l=s&&this.controls[s]||null;return l?r?l.getControl(r):l:null}reset(t){Object.keys(this.controls).forEach(e=>{this.controls[e].reset(t[e])})}}const a=/^\[(\d+)\]\.?(.*)$/;class u extends l{constructor(l,o=[]){super(o),this._controls=l,this.controlStore=t(this._controls),this.valueDerived=e(this.controlStore,(t,s)=>e(t.map(t=>t.value),t=>t).subscribe(s)),this.childStateDerived=e(this.controlStore,(t,s)=>e(t.map(t=>t.state),t=>t).subscribe(s)),this.value={subscribe:this.valueDerived.subscribe,set:t=>this.setValue(t),update:t=>this.setValue(t(s(this.valueDerived)))},this.state=e([this.valueDerived,this.childStateDerived],([t,e])=>{const s=[];let l=!0;for(let t=0,r=e.length;t<r;t++){const r=e[t];s[t]=r,l=l&&r.$valid,s.$touched=s.$touched||r.$touched,s.$dirty=s.$dirty||r.$dirty}return s.$error=r(this.validators,t),s.$valid=null==s.$error&&l,s})}setValue(t){s(this.controlStore).forEach((e,s)=>e.value.set(t[s]))}setTouched(t){s(this.controlStore).forEach(e=>e.setTouched(t))}get size(){return s(this.controlStore).length}get controls(){return s(this.controlStore)}pushControl(t){this.controlStore.update(e=>(e.push(t),e))}addControlAt(t,e){this.controlStore.update(s=>(s.splice(t,0,e),s))}removeControlAt(t){this.controlStore.update(e=>(e.splice(t,1),e))}slice(t,e){this.controlStore.update(s=>s.slice(t,e))}getControl(t){const[e,r,l]=t.match(a)||[],o=s(this.controlStore),i=null!=r&&o[+r]||null;return i?l?i.getControl(l):i:null}reset(t){s(this.controlStore).forEach((e,s)=>e.reset(t&&t[s]))}setValidators(t){Array.isArray(t)&&t.length&&(this.validators=t)}}const c=(t,e)=>{if(!(e instanceof o))throw new Error("must be used with a Control class");const s=t.classList,r=e.state.subscribe(t=>{t.$error?(s.add("invalid"),s.remove("valid")):(s.add("valid"),s.remove("invalid")),t.$dirty?(s.add("dirty"),s.remove("pristine")):(s.add("pristine"),s.remove("dirty")),t.$touched?s.add("touched"):s.remove("touched")}),l=["blur","focusout"],i=()=>l.forEach(e=>t.removeEventListener(e,n)),n=()=>{e.setTouched(!0),i()};return l.forEach(e=>t.addEventListener(e,n)),{destroy(){i(),r()}}},h=({onlyTouched:t=!1}={})=>(e,s)=>{if(!(s instanceof o))throw new Error("must be used with a Control class");return{destroy:s.state.subscribe(s=>{const r=s,l=!(t&&!r.$touched||!r.$error);e.hidden=!l,l&&(e.innerHTML=r.$error)})}},d=h(),v=(t,e=!0)=>s=>{let r=null!=s?`${s}`:"";return e&&(r=r.trim()),""!==r?null:t},$=/^([a-zA-Z0-9_\-\.]+)@([a-zA-Z0-9_\-\.]+)\.([a-zA-Z]{2,5})$/,b=t=>e=>null==e||$.test(e)?null:t,y=(t,e)=>s=>null!=s&&(null==e||`${s}`.length>=e)?null:t,f=(t,e)=>s=>null!=s&&(null==e||`${s}`.length<=e)?null:t,p=t=>e=>null==e||!isNaN(e)?null:t,m=/^[\d.]+$/,S=t=>e=>null==e||!isNaN(e)&&m.test(`${e}`)?null:t,g=/^[\d]+$/,E=t=>e=>null==e||!isNaN(e)&&g.test(`${e}`)?null:t,A=(t,e)=>s=>null==s||!isNaN(s)&&(null==e||s>=e)?null:t,C=(t,e)=>s=>null==s||!isNaN(s)&&(null==e||s<=e)?null:t,N=(t,e)=>s=>null==s||null==e||e.test(s)?null:t;export{o as Control,u as ControlArray,l as ControlBase,n as ControlGroup,c as controlClasses,d as controlError,h as controlErrorFactory,S as decimal,b as email,E as integer,C as max,f as maxLength,A as min,y as minLength,p as number,N as pattern,v as required};
//# sourceMappingURL=index.mjs.map
